{"version":3,"file":"run-fe9e8a93.js","sources":["../../../.svelte-kit/adapter-node/chunks/run.js"],"sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\nimport shell from \"shelljs\";\nimport os from \"os\";\nconst n = os.networkInterfaces();\nfunction getLocalIP() {\n  for (const k in n) {\n    const inter = n[k];\n    for (const j in inter)\n      if (inter[j].family === \"IPv4\" && !inter[j].internal)\n        return inter[j].address;\n  }\n}\nconst { pathname: __dirname } = new URL(\"../../../../\", import.meta.url);\nconst fileExists = (file) => {\n  return JSON.parse(shell.exec(`if [[ -f ${file} ]]; then echo 'true'; else echo 'false'; fi;`).stdout.trim());\n};\nconst LOCAL_IP = getLocalIP();\nconst toReplace = \"#--server-config--#\";\nif (!shell.which(\"mkcert\")) {\n  shell.echo('Sorry, this script requires \"mkcert\"');\n  shell.exit(1);\n}\nif (!shell.which(\"git\")) {\n  shell.echo('Sorry, this script requires \"docker\"');\n  shell.exit(1);\n}\nconst run = () => {\n  const configPath = path.resolve(__dirname, \"config.json\");\n  if (!fileExists(configPath)) {\n    console.log(\"Sorry, config.json does not exists.\");\n  }\n  const config = JSON.parse(fs.readFileSync(configPath, { encoding: \"utf8\" }) || \"[]\");\n  const nginxConfServerTplPath = path.resolve(__dirname, \"assets/nginx.conf.server.tpl\");\n  const certsUrl = [];\n  const serverConfigs = config.map((c) => {\n    if (!fileExists(nginxConfServerTplPath)) {\n      console.log(\"Sorry, is not possible to find './nginx.conf.server.tpl' file.\");\n    }\n    const nginxConfServerTpl = fs.readFileSync(nginxConfServerTplPath, { encoding: \"utf8\" });\n    if (c.nginxConf) {\n      return nginxConf;\n    }\n    certsUrl.push({\n      cert: c.ssl.cert,\n      key: c.ssl.key\n    });\n    return nginxConfServerTpl.replaceAll(\"%APP_DOMAIN%\", c.localDomainName).replace(\"%LOCAL_IP%\", LOCAL_IP).replace(\"%PORT%\", c.port);\n  });\n  const nginxConfTplPath = path.resolve(__dirname, \"assets/nginx.conf.tpl\");\n  if (!fileExists(nginxConfTplPath)) {\n    console.log(\"Sorry, is not possible to find 'nginx.conf.tpl' file.\");\n  }\n  const nginxConfTpl = fs.readFileSync(nginxConfTplPath, { encoding: \"utf8\" });\n  const nginxConf = nginxConfTpl.replace(toReplace, serverConfigs.join(\"\\n\"));\n  const nginxConfDest = path.resolve(__dirname, \"nginx.conf\");\n  fs.writeFileSync(nginxConfDest, nginxConf);\n  const dockerfileTplPath = path.resolve(__dirname, \"Dockerfile.tpl\");\n  const dockerfileContent = fs.readFileSync(dockerfileTplPath, { encoding: \"utf8\" });\n  const dockerfileDest = path.resolve(__dirname, \"Dockerfile\");\n  fs.writeFileSync(dockerfileDest, dockerfileContent.replace(\n    \"#-certs-#\",\n    certsUrl.map((d) => {\n      return `COPY ${d.key} /etc/nginx/\nCOPY ${d.cert} /etc/nginx/`;\n    }).join(\"\\n\")\n  ));\n  shell.exec(`NAME=local-443-proxy && \tdocker rm -f $NAME && \tdocker rmi -f $NAME && \tdocker build --no-cache -t $NAME . && \tdocker run --name $NAME -p 80:80 -p 443:443 -d $NAME && \tdocker ps`);\n  config.forEach((c) => {\n    const curl = `curl -s -o /dev/null -w \"%{http_code}\" https://${c.localDomainName}`;\n    const status = shell.exec(curl).stdout;\n    if (status === \"200\") {\n      console.log(` - https://${c.localDomainName} ✅`);\n    } else {\n      console.log(` - https://${c.localDomainName} ❌`);\n    }\n  });\n};\nexport {\n  run as r\n};\n"],"names":[],"mappings":"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"}